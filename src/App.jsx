// App.jsx
import "./App.css";
import { useState } from "react";
import { shuffleArray } from "./utils/shuffle";
import SeatGrid from "./components/SeatGrid";
import ResultScreen from "./components/ResultScreen";
import Confetti from "react-confetti";

function App() {
  const [rows, setRows] = useState(3); // è¡Œæ•°ï¼ˆç¸¦ã®åˆ—æ•°ï¼‰
  const [cols, setCols] = useState(4); // åˆ—æ•°ï¼ˆæ¨ªã®åˆ—æ•°ï¼‰
  const [names, setNames] = useState(Array(12).fill("")); // åˆæœŸã®åå‰ãƒªã‚¹ãƒˆï¼ˆ12äººåˆ†ï¼‰
  const [fixedSeats, setFixedSeats] = useState(Array(12).fill(false)); // å›ºå®šå¸­ã®çŠ¶æ…‹
  const [isShuffling, setIsShuffling] = useState(false); // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸­ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
  const [showOverlay, setShowOverlay] = useState(false); // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®è¡¨ç¤ºãƒ•ãƒ©ã‚°
  const [showConfetti, setShowConfetti] = useState(false); // ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ã®è¡¨ç¤ºãƒ•ãƒ©ã‚°

  // åå‰ã®å¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
  // index: åå‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹, value: æ–°ã—ã„åå‰
  // names: ç¾åœ¨ã®åå‰ãƒªã‚¹ãƒˆ
  // setNames: åå‰ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  // ã“ã®é–¢æ•°ã¯ã€æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®åå‰ã‚’æ–°ã—ã„å€¤ã«æ›´æ–°ã—ã¾ã™ã€‚
  // ä¾‹ãˆã°ã€handleNameChange(0, "Ando")ã¯æœ€åˆã®åå‰ã‚’"Ando"ã«å¤‰æ›´ã—ã¾ã™ã€‚
  // ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ
  // åå‰ã‚’å…¥åŠ›ã—ãŸã‚Šå¤‰æ›´ã—ãŸã‚Šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
  // namesã®é…åˆ—ã¯ã€è¡Œæ•°ã¨åˆ—æ•°ã«åŸºã¥ã„ã¦å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚
  // åˆæœŸçŠ¶æ…‹ã§ã¯ã€å…¨ã¦ã®åå‰ã¯ç©ºæ–‡å­—åˆ—ã§åŸ‹ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåå‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€
  // ãã®åå‰ãŒnamesé…åˆ—ã®å¯¾å¿œã™ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ä¿å­˜ã•ã‚Œã¾ã™
  // ä¾‹ãˆã°ã€3è¡Œ4åˆ—ã®ã‚°ãƒªãƒƒãƒ‰ã§ã¯ã€namesã¯12å€‹ã®è¦ç´ ã‚’æŒã¡ã¾ã™ã€‚
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåå‰ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§
  // namesé…åˆ—ã®å„è¦ç´ ãŒæ›´æ–°ã•ã‚Œã€å¸­æ›¿ãˆã®å¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚
  // ã“ã®é–¢æ•°ã¯ã€å¸­æ›¿ãˆã®éš›ã«åå‰ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
  const handleNameChange = (index, value) => {
    const updated = [...names];
    updated[index] = value;
    setNames(updated);
  };

  // å›ºå®šå¸­ã®ãƒˆã‚°ãƒ«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
  // index: å›ºå®šå¸­ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  // ã“ã®é–¢æ•°ã¯ã€æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å›ºå®šå¸­ã®çŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«ã—ã¾ã™ã€‚
  // ä¾‹ãˆã°ã€toggleFixedSeat(0)ã¯æœ€åˆã®å¸­ã®å›ºå®šçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚
  // fixedSeatsã¯ã€å„å¸­ãŒå›ºå®šã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã™
  // çœŸå½å€¤ã®é…åˆ—ã§ã™ã€‚
  // åˆæœŸçŠ¶æ…‹ã§ã¯ã€å…¨ã¦ã®å¸­ã¯å›ºå®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¸­ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ãã®å¸­ã®åå‰ã¯ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã®å¯¾è±¡å¤–ã¨ãªã‚Šã¾ã™ã€‚
  // ä¾‹ãˆã°ã€3è¡Œ4åˆ—ã®ã‚°ãƒªãƒƒãƒ‰ã§ã¯ã€fixedSeatsã¯12å€‹ã®è¦ç´ ã‚’æŒã¡ã¾ã™ã€‚
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®å¸­ã‚’å›ºå®šã™ã‚‹ã¨ã€ãã®å¸­ã®åå‰ã¯
  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã®éš›ã«å¤‰æ›´ã•ã‚Œãšã€å›ºå®šã•ã‚ŒãŸã¾ã¾ã¨ãªã‚Šã¾ã™ã€‚
  // ã“ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ç‰¹å®šã®å¸­ã«ç‰¹å®šã®åå‰ã‚’å›ºå®šã—ã¦ãŠãã“ã¨ãŒã§ãã¾ã™ã€‚
  // ã“ã‚Œã«ã‚ˆã‚Šã€ç‰¹å®šã®å¸­ã«ç‰¹å®šã®åå‰ã‚’å‰²ã‚Šå½“ã¦ãŸã„å ´åˆã«ä¾¿åˆ©ã§ã™ã€‚
  // ä¾‹ãˆã°ã€è¬›å¸«ã®å¸­ã‚„ç‰¹å®šã®ç”Ÿå¾’ã®å¸­ã‚’å›ºå®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
  // ã“ã®é–¢æ•°ã¯ã€å¸­æ›¿ãˆã®éš›ã«åå‰ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
  const toggleFixedSeat = (index) => {
    const updated = [...fixedSeats];
    updated[index] = !updated[index];
    setFixedSeats(updated);
  };

  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
  // ã“ã®é–¢æ•°ã¯ã€å¸­æ›¿ãˆã‚’é–‹å§‹ã™ã‚‹ãŸã‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã™
  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸­ã®ãƒ•ãƒ©ã‚°ã‚’trueã«è¨­å®šã—ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
  // 5ç§’å¾Œã«ã€å›ºå®šã•ã‚Œã¦ã„ãªã„å¸­ã®åå‰ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã€
  // æ–°ã—ã„åå‰ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚
  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒå®Œäº†ã—ãŸã‚‰ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸­ã®ãƒ•ãƒ©ã‚°ã‚’falseã«è¨­å®šã—ã€
  // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤ºã«ã—ã€ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
  // ã“ã®é–¢æ•°ã¯ã€å¸­æ›¿ãˆã®éš›ã«
  // åå‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹æ›¿ãˆã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã®éš›ã«ã¯ã€å›ºå®šã•ã‚Œã¦ã„ã‚‹å¸­ã®åå‰ã¯å¤‰æ›´ã•ã‚Œãšã€
  // å›ºå®šã•ã‚Œã¦ã„ãªã„å¸­ã®åå‰ã®ã¿ãŒãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹æ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚
  // ã“ã‚Œã«ã‚ˆã‚Šã€ç‰¹å®šã®å¸­ã«ç‰¹å®šã®åå‰ã‚’å›ºå®šã—ã¤ã¤ã€
  // ä»–ã®å¸­ã®åå‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
  const handleShuffle = () => {
    setIsShuffling(true);
    setShowOverlay(true);
    setShowConfetti(false);

    setTimeout(() => {
      const movable = names.filter((_, i) => !fixedSeats[i]);
      const shuffled = shuffleArray(movable);
      const newNames = names.map((name, i) =>
        fixedSeats[i] ? name : shuffled.shift() || ""
      );
      setNames(newNames);
      setIsShuffling(false);
      setShowOverlay(false);
      setShowConfetti(true);
    }, 5000); // 5ç§’å¾Œã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«å®Œäº†
  };

  // ãƒªã‚»ãƒƒãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
  // ã“ã®é–¢æ•°ã¯ã€å…¨ã¦ã®åå‰ã¨å›ºå®šå¸­ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚
  // åå‰ãƒªã‚¹ãƒˆã‚’ç©ºæ–‡å­—åˆ—ã§åŸ‹ã‚ã€å›ºå®šå¸­ã®çŠ¶æ…‹ã‚’å…¨ã¦falseã«è¨­å®šã—ã¾ã™ã€‚
  // ã¾ãŸã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¨ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ã®è¡¨ç¤ºã‚’éè¡¨ç¤ºã«ã—ã¾ã™ã€‚
  // ã“ã®é–¢æ•°ã¯ã€å¸­æ›¿ãˆã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¨ã¦ã®åå‰ã‚’ã‚¯ãƒªã‚¢ã—ã€å¸­æ›¿ãˆã‚’å†åº¦è¡Œã„ãŸã„å ´åˆã«ä¾¿åˆ©ã§ã™ã€‚
  // ä¾‹ãˆã°ã€å¸­æ›¿ãˆã‚’è¡Œã£ãŸå¾Œã«å…¨ã¦ã®åå‰ã‚’ã‚¯ãƒªã‚¢ã—ã¦
  // æ–°ã—ã„åå‰ã‚’å…¥åŠ›ã—ç›´ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
  const handleClear = () => {
    setNames(Array(rows * cols).fill(""));
    setFixedSeats(Array(rows * cols).fill(false));
    setShowOverlay(false);
    setShowConfetti(false);
  };

  return (
    <>
      {/* ğŸ”¥ ç”»é¢å…¨ä½“ã«é‡ã­ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */}
      {showOverlay && (
        <div className="dark-screen">
          <ResultScreen showResult={true} />
        </div>
      )}

      {/* ğŸ‰ ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ */}
      {showConfetti && (
        <Confetti width={window.innerWidth} height={window.innerHeight} />
      )}

      {/* ğŸ’» ã‚¢ãƒ—ãƒªæœ¬ä½“ */}
      <div className="app-container">
        <h1>å¸­æ›¿ãˆã‚¢ãƒ—ãƒª</h1>
        <div className="board-header">ğŸ§­ ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ï¼ˆå‰æ–¹ï¼‰</div>

        <SeatGrid
          names={names}
          onNameChange={handleNameChange} // åå‰ã®å¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
          cols={cols} // åˆ—æ•°
          fixedSeats={fixedSeats} // å›ºå®šå¸­ã®çŠ¶æ…‹
          onToggleFixed={toggleFixedSeat} // å›ºå®šå¸­ã®ãƒˆã‚°ãƒ«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
          isShuffling={isShuffling} // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸­ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
        />

        <div className="button-group">
          <button onClick={handleShuffle}>å¸­æ›¿ãˆã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          {/* å¸­æ›¿ãˆã‚’é–‹å§‹ã™ã‚‹ãƒœã‚¿ãƒ³ */}
          <button onClick={handleClear}>ãƒªã‚»ãƒƒãƒˆ</button>
          {/* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */}
        </div>

        <div className="settings">
          <label>
            åˆ—ï¼ˆæ¨ªï¼‰:
            <input
              type="number"
              value={cols} // åˆ—æ•°
              onChange={(e) => {
                const val = Number(e.target.value); // æ•°å€¤ã«å¤‰æ›
                setCols(val); // åˆ—æ•°ã‚’æ›´æ–°// è¡Œæ•°ã¨åˆ—æ•°ã«åŸºã¥ã„ã¦åå‰ãƒªã‚¹ãƒˆã¨å›ºå®šå¸­ã®çŠ¶æ…‹
                setNames(Array(rows * val).fill("")); // åå‰ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                setFixedSeats(Array(rows * val).fill(false)); // å›ºå®šå¸­ã®çŠ¶æ…‹ã‚’æ›´æ–°
                // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¨ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ã®è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
                setShowOverlay(false); // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤º
                setShowConfetti(false); // ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ã‚’éè¡¨ç¤º
              }}
            />
          </label>
          <label>
            è¡Œï¼ˆç¸¦ï¼‰:
            <input
              type="number"
              value={rows} // è¡Œæ•°
              onChange={(e) => {
                const val = Number(e.target.value); // æ•°å€¤ã«å¤‰æ›
                setRows(val); // è¡Œæ•°ã‚’æ›´æ–°
                setNames(Array(val * cols).fill("")); // åå‰ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                // è¡Œæ•°ã¨åˆ—æ•°ã«åŸºã¥ã„ã¦åå‰ãƒªã‚¹ãƒˆã¨å›ºå®šå¸­ã®çŠ¶æ…‹
                setFixedSeats(Array(val * cols).fill(false)); // å›ºå®šå¸­ã®çŠ¶æ…‹ã‚’æ›´æ–°
                setShowOverlay(false); // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤º
                setShowConfetti(false); // ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ã‚’éè¡¨ç¤º
              }}
            />
          </label>
        </div>
      </div>
    </>
  );
}

export default App;
